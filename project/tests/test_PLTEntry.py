import unittest
import unittest.mock

from myCode import PLTEntry
from myCode import MyUtils
from myCode.CustomExceptions import *


class PLTEntryTests(unittest.TestCase):

    DUMP_FILE_CONTENT1 = "4D4C4D4C56534D4C001000400000000100020001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    defaultMap = dict()

    @classmethod
    def setUpClass(self):
        self.defaultMap = [0]

    def test_contructor(self):
        pltEntry = PLTEntry.PLTEntry([0])
        self.assertEqual(self.defaultMap, pltEntry.toMap())

    def test_contructor2(self):
        self.assertRaises(ValueError, PLTEntry.PLTEntry, 'ABC')

    def test_toMap(self):
        pltEntry = PLTEntry.PLTEntry([0])
        map = pltEntry.toMap()

        self.assertEqual(self.defaultMap, map)

    def test_getPLTEntrySizeWithPageNumber(self):
        hex = self.DUMP_FILE_CONTENT1
        expectedResult = 8288
        pltEntrySize = PLTEntry.getPLTEntrySizeWithPageNumber(hex, 3)
        self.assertEqual(expectedResult, pltEntrySize)

    @unittest.mock.patch('myCode.MyUtils.readBlockFromFileInHex')
    def test_removePLTEntryDataExtraZeros1(self, mock_utils):
        hex = "4D4C4D4C56534D4C000800400000000100030001"
        expectedValue = "005403"
        while len(hex) < 2048:
            hex = hex + "00"
        dump = "0054030000000000000000000000000000000000000000000000000000000000"
        mock_utils.return_value = dump
        data = PLTEntry.removePLTEntryDataExtraZeros(hex, 3)
        self.assertEqual(expectedValue, data)

    @unittest.mock.patch('myCode.MyUtils.readBlockFromFileInHex')
    def test_removePLTEntryDataExtraZeros2(self, mock_utils):
        hex = "4D4C4D4C56534D4C000800400000000100030001"
        expectedValue = "00540330"
        while len(hex) < 2048:
            hex = hex + "00"
        dump = "0054033000000000000000000000000000000000000000000000000000000000"
        mock_utils.return_value = dump
        data = PLTEntry.removePLTEntryDataExtraZeros(hex, 3)
        self.assertEqual(expectedValue, data)

    @unittest.mock.patch('myCode.PLTEntry.removePLTEntryDataExtraZeros')
    def test_getProcessusPages(self, mock_utils):
        hex = "4D4C4D4C56534D4C000800400000000100030001"
        expectedValue = [84, 42]
        mock_utils.return_value = "82542A"
        data = PLTEntry.getProcessusPages(hex, 3)
        self.assertEqual(expectedValue, data.toMap())

    if __name__ == "__main__":
        unittest.main()
